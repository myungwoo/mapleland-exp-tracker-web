# 🍁 메이플랜드 경험치 측정기 (웹)

[![Website - Live](https://img.shields.io/badge/Website-Live-2ea44f?style=flat&logo=githubpages)](https://myungwoo.github.io/mapleland-exp-tracker-web/)
[![Next.js](https://img.shields.io/badge/Next.js-15-black?logo=nextdotjs)](https://nextjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.x-3178C6?logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind%20CSS-3.x-06B6D4?logo=tailwindcss&logoColor=white)](https://tailwindcss.com/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Deploy](https://github.com/myungwoo/mapleland-exp-tracker-web/actions/workflows/gh-pages.yml/badge.svg)](.github/workflows/gh-pages.yml)

**설치 없이 브라우저에서 바로 쓰는 메이플랜드 경험치(Exp) 측정/페이스 확인 도구**입니다.
게임 창을 캡처로 선택하고, 레벨/EXP 표시 영역(ROI)만 한 번 지정하면 **경과 시간 대비 누적 경험치, 페이스, 예상 진행 시각**을 깔끔하게 보여줍니다.

---

## 🚀 바로 사용하기
- **라이브 웹앱**: [myungwoo.github.io/mapleland-exp-tracker-web](https://myungwoo.github.io/mapleland-exp-tracker-web/)
- **처음 한 번**: 브라우저의 화면/창 캡처 권한이 필요합니다.

---

## 🎯 이런 분께 추천해요
- **파티 구성에 따른 경험치 효율** 을 수치로 확인하고 싶은 분
- **경험치 페이스, 시간당 경험치 획득량**을 깔끔하게 보고 싶은 분
- **별도 프로그램 다운로드/설치 없이** 브라우저에서 바로 경험치 측정기를 쓰고 싶은 분

---

## ❓ 이 측정기는 무엇이 다른가요?
많은 분들이 사용하시던 “경험치 측정기 프로그램”과 관련해 제재(1일 정지 등) 이슈가 있었고, 저 역시 해당 프로그램 사용으로 불편을 겪었습니다.
제가 이해하기로 당시 문제가 된 지점은 대략 아래와 같았습니다.

- 약관에 명시된 **‘비인가 프로그램’** 에 해당할 수 있는 형태였던 점
- 비인가 프로그램과 게임을 동시에 실행할 때 **사용자 PC 보안/개인정보 유출 위험**이 생길 수 있다는 점

결국 유저 보호를 위한 **경고성 제재**의 성격이 강하다고 판단했고, 그래서 **별도의 프로그램 다운로드/실행 없이, 웹 브라우저만으로 동작하는 방식**의 경험치 측정기를 만들기 시작했습니다.

### 🧠 어떻게 동작하나요? (원리)
- HTML5 표준의 **화면 공유(화면/창 캡처)** 기능을 사용합니다. (디스코드 화면 공유와 같은 원리)
- 브라우저에서 동작하는 **JavaScript 기반 OCR(글자 인식)** 으로, 지정한 ROI 영역의 글자를 읽습니다.

### ✅ 그래서 뭐가 좋은가요? (웹 방식의 장점)
- **설치/실행 프로그램이 필요 없음**: 링크만 열면 됩니다.
- **로컬에서만 처리**: OCR(Tesseract.js)은 브라우저 내부(Web Worker)에서 동작하고, **캡처 이미지/인식 결과는 서버로 전송되지 않습니다.**
- **항상 위(PiP)로 작게 띄우기**: Document Picture‑in‑Picture로 진행 상황을 작은 창에서 계속 볼 수 있습니다.
- **설정 자동 유지**: ROI/측정 주기/차트 표시 옵션 등 설정은 **LocalStorage**에 저장되어 다음에 다시 켰을 때 편합니다.
- **기록 자동 유지**: 측정 기록(세션 스냅샷)은 **IndexedDB(브라우저 내 로컬 DB)**에 저장됩니다.

### ⚠️ 안내 (중요)
그럼에도 불안하시거나 조금이라도 찝찝하신 분들은 **사용하지 않으시는 것이 가장 좋습니다.**
이 README는 사이트의 **동작 방식과 의도**를 설명드리기 위한 것이며, **사용 여부는 전적으로 각자의 판단**에 맡기겠습니다.

---

## ✨ 주요 기능
- **게임 창 선택**: 화면/창 캡처로 메이플랜드 창을 선택 (브라우저 권한 필요)
- **ROI 지정**:
  - 레벨 ROI: 레벨 숫자 영역
  - 경험치 ROI: `XXXXXXXX[YY.YY%]` 전체가 들어오도록 지정
- **측정 제어**: 시작/일시정지/재개/초기화 (Space 단축키 지원, R로 초기화)
- **지표 표시**:
  - 누적 경험치(값/퍼센트)
  - 페이스 기준 시간(X분) 기반 페이스
  - 다음 `N시간 되는 시각` 표시
- **기록**: 측정 결과(세션 상태)를 저장/불러오기, JSON 파일로 내보내기/파일에서 불러오기 (저장/불러오기는 측정 일시정지 상태에서만 가능)
  - 기록은 브라우저 로컬 **IndexedDB**에 저장됩니다. (서버 전송 없음)
- **결과 텍스트 복사**: 경과 시간/획득 EXP/페이스를 텍스트로 클립보드에 복사
- **결과 이미지 복사**: 요약 카드(측정 정보)를 PNG 이미지로 클립보드에 복사
- **디버그 미리보기**: 전처리 전/후 이미지 비교
- **PiP 모드**: 항상 위 미니 창에서 확인 + 시작/일시정지/초기화 제어

---

## 🧭 3분 튜토리얼
1. 첫 접속 시 화면 중앙의 튜토리얼을 따라가면 됩니다.
2. **게임 창 선택**을 눌러 캡처 권한을 허용하고, 메이플랜드 게임 창을 선택하세요.
   - 브라우저 정책상 **새로고침/재접속 시 다시 선택이 필요**할 수 있습니다.
3. **레벨 ROI**: 레벨 숫자만 포함되도록 드래그해 지정합니다. `LV.` 텍스트는 제외하세요.
4. **경험치 ROI**: `XXXXXXXX[YY.YY%]` 전체가 들어오도록 드래그해 지정합니다. `EXP.` 텍스트는 제외하세요.
   - **중요**: 게임 내 글꼴을 **비트맵 글꼴로 설정하면 인식이 잘 되지 않습니다.** 경험치 측정은 <span className="font-semibold">“메이플스토리 월드 기본”</span> 글꼴 사용을 전제로 합니다.
5. 렉이 느리면 **측정 주기(1/5/10초)**를 올려서 부담을 줄이세요.
6. 필요하면 **PiP 열기**로 작은 항상 위 창을 띄워두고 플레이하세요. (Chrome/Edge 최신 권장)

### 🔁 튜토리얼을 건너뛰었거나 다시 설정하려면
- 좌상단 `설정` 버튼 → `게임 창 선택`
- `레벨 ROI 설정` / `경험치 ROI 설정`으로 각각 영역 지정
- Space: 시작/일시정지, R: 초기화, P: PiP 열기

---

## 🎯 정확도 & 문제 해결

- **비트맵 글꼴 미지원**: 게임 내 글꼴이 **비트맵 글꼴**이면 OCR이 6/8/3/9 등을 자주 혼동할 수 있어 정확한 측정이 어렵습니다. **“메이플스토리 월드 기본” 글꼴** 사용을 권장합니다.

- **ROI(레벨/경험치 인식 영역) 설정이 어려울 때**:
  - ROI를 잡을 때는 **튜토리얼에 나오는 "올바른 선택 예시" 이미지를 참고해서** 다시 한번 영역을 설정해보세요.
  - 레벨 ROI는 숫자(흰색)만 딱 들어오게, `LV.` 텍스트는 제외하고 주황 박스 위 숫자만 포함시키는 게 좋습니다.
  - 경험치 ROI는 `XXXXXXXX[YY.YY%]` 패턴이 모두 포함되도록, `EXP.` 텍스트는 제외하고, **대괄호와 퍼센트까지 전체**가 들어오게 하세요.
  - ROI는 **너무 넓게 잡지 않는 것**이 더 안정적입니다. 위/아래로 약간의 여백만 남기고 “짤리지 않게” 타이트하게 잡으세요.
  - 잘 인식되지 않거나 오인식된다면 튜토리얼 예시처럼 다시 한번 ROI를 지정해보세요.

- **게임 해상도가 낮다면**:
  - 창모드에서 **게임 창 크기** 또는 **전체 디스플레이 해상도가 너무 낮은 경우** 인식률이 크게 떨어질 수 있습니다.
  - ROI 내부 픽셀 수가 너무 적으면 이미지가 뭉개져서 정상 작동하지 않을 수 있습니다.
  - 가능하다면 **게임 해상도를 높이거나 창 크기를 키우고**, ROI를 다시 지정해보세요.

- **OCR(글씨 인식)이 잘 되는지 확인하려면**:
  - "설정" 창에서 **"디버그 미리보기"** 옵션을 켜면 실시간으로 인식결과와 전/후처리 이미지를 같이 볼 수 있어, 제대로 동작하는지 직접 확인하는 데 도움이 됩니다.
  - 디버그 미리보기를 통해 인식이 어떻게 되고 있는지 확인해보고, 필요하다면 ROI를 다시 조정해 주세요.

- **"게임 창 선택" 목록이 비어있을 때**:
  - 브라우저/OS의 **화면 녹화(화면 캡처) 권한**을 확인하고 재시도하세요.

---

## 🔒 권한과 개인정보
- 화면/창 캡처 권한은 브라우저가 제공하며, **선택한 윈도우 영역만** 캡처합니다.
- OCR(Tesseract.js)은 브라우저 내부(Web Worker)에서 동작합니다.
- 캡처 이미지/인식 결과/설정/기록은 **서버로 전송되지 않으며**, 설정은 로컬(LocalStorage), 기록은 로컬(IndexedDB)에 저장됩니다.

---

## 🌐 브라우저 호환성
- **Chrome/Edge의 최신 버전 사용을 권장합니다.**
- 다른 브라우저(예: Safari, Firefox)나 환경에서는 별도로 테스트하지 않았으니, 정상 동작을 보장할 수 없습니다.
- Safari는 권한 팝업 등 일부 동작 방식이 다를 수 있습니다.

---

## ⌨️ (고급) F6 같은 “전역 단축키”로 시작/일시정지 토글하기 (Windows)
브라우저는 보안상 “게임 창 포커스에서도 동작하는 전역(Global) 핫키”를 직접 받을 수 없습니다.
대신 **로컬 파이썬 스크립트가 전역 핫키를 감지 → 로컬 WebSocket으로 웹앱에 메시지를 보내는 방식**을 (고급 사용자용으로) 제공합니다.

> 이 기능은 **UI에 노출되지 않습니다.** (일반 사용자를 위해 기본 비활성)
> 또한 기본 상태에서는 **연결 시도 자체가 없어서 성능 영향이 없습니다.** (서버가 없어도 동일)

### 1) 웹앱에서 기능 활성화(개발자 도구)
웹앱 탭에서 개발자 도구 Console을 열고 아래를 실행한 뒤 새로고침하세요.

```js
localStorage.setItem("externalWsEnabled", "true");
localStorage.setItem("externalWsUrl", "ws://127.0.0.1:21537");
location.reload();
```

비활성화하려면 아래를 실행한 뒤 새로고침하세요.

```js
localStorage.removeItem("externalWsEnabled");
localStorage.removeItem("externalWsUrl");
location.reload();
```

### 2) 로컬 WS + 핫키 서버 실행

```bash
python -m pip install -r tools/hotkey-ws/requirements.txt
python tools/hotkey-ws/hotkey_ws_server.py
```

- 기본 핫키:
  - **F6** → 측정 시작/일시정지 **토글** (`{"type":"toggle"}`)
  - **F7** → **초기화** (`{"type":"reset"}`)

> 참고: Windows 환경에 따라 전역 키 훅이 막히면 “관리자 권한으로 실행”이 필요할 수 있습니다.

---

## 🧑‍💻 로컬 실행 (개발용)

```bash
npm install
npm run dev
# http://localhost:3000
```

- Node.js 18+ 권장
- 정적 배포: `npm run build && npm run export`

---

## 🧰 기술 스택
- Next.js 15 (App Router, 정적 Export)
- React 18 + TypeScript
- Tailwind CSS
- Tesseract.js (Web Worker OCR)
- Zustand / LocalStorage(설정 저장) / IndexedDB(기록 저장)

---

## 📝 라이선스
이 프로젝트는 MIT 라이선스에 따라 배포됩니다. 자세한 내용은 [LICENSE](LICENSE)를 참고하세요.

---

## 🙏 크레딧
- OCR: [Tesseract.js](https://github.com/naptha/tesseract.js)
