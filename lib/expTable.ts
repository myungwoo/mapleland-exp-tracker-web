export type ExpTable = Record<number, number>;

export const EXP_TABLE: ExpTable = {
	1: 15, 2: 34, 3: 57, 4: 92, 5: 135, 6: 372, 7: 560, 8: 840, 9: 1242, 10: 1716,
	11: 2360, 12: 3216, 13: 4200, 14: 5460, 15: 7050, 16: 8840, 17: 11040, 18: 13716,
	19: 16680, 20: 20216, 21: 24402, 22: 28980, 23: 34320, 24: 40512, 25: 54900,
	26: 57210, 27: 63666, 28: 73080, 29: 83270, 30: 95700, 31: 108480, 32: 122760,
	33: 138666, 34: 155540, 35: 174216, 36: 194832, 37: 216600, 38: 240550, 39: 266682,
	40: 294216, 41: 324240, 42: 356916, 43: 391160, 44: 428280, 45: 468450, 46: 510420,
	47: 555680, 48: 604416, 49: 655200, 50: 709716, 51: 748608, 52: 789631, 53: 832902,
	54: 878545, 55: 926689, 56: 977471, 57: 1031036, 58: 1087536, 59: 1147132, 60: 1209904,
	61: 1276301, 62: 1346242, 63: 1420016, 64: 1497832, 65: 1579913, 66: 1666492,
	67: 1757185, 68: 1854143, 69: 1955750, 70: 2062925, 71: 2175973, 72: 2295216,
	73: 2420993, 74: 2553663, 75: 2693603, 76: 2841212, 77: 2996910, 78: 3161140,
	79: 3334370, 80: 3517903, 81: 3709827, 82: 3913127, 83: 4127556, 84: 4353756,
	85: 4592341, 86: 4844001, 87: 5109452, 88: 5389449, 89: 5684790, 90: 5996316,
	91: 6324914, 92: 6617519, 93: 7037118, 94: 7422752, 95: 7829518, 96: 8258575,
	97: 8711144, 98: 9188514, 99: 9620440, 100: 10223168, 101: 10783397, 102: 11374327,
	103: 11997640, 104: 12655110, 105: 13348610, 106: 14080113, 107: 14851703,
	108: 15665576, 109: 16524049, 110: 17429566, 111: 18384706, 112: 19392187,
	113: 20454878, 114: 21575805, 115: 22758159, 116: 24005306, 117: 25320796,
	118: 26708375, 119: 28171993, 120: 29715818, 121: 31344244, 122: 33061908,
	123: 34873700, 124: 36784778, 125: 38800583, 126: 40926854, 127: 43169645,
	128: 45535341, 129: 48030677, 130: 50662758, 131: 53439077, 132: 56367538,
	133: 59456479, 134: 62714694, 135: 66151459, 136: 69776558, 137: 73600313,
	138: 77633610, 139: 81887931, 140: 86375389, 141: 91108760, 142: 96101520,
	143: 101367883, 144: 106922842, 145: 112782213, 146: 118962678, 147: 125481832,
	148: 132358236, 149: 139611467, 150: 147262175, 151: 155332142, 152: 163844343,
	153: 172823012, 154: 182293713, 155: 192283408, 156: 202820538, 157: 213935103,
	158: 225658746, 159: 238024845, 160: 251068606, 161: 264827165, 162: 279339693,
	163: 294647508, 164: 310794191, 165: 327825712, 166: 345790561, 167: 364739883,
	168: 384727628, 169: 405810702, 170: 428049128, 171: 451506220, 172: 476248760,
	173: 502347192, 174: 529875818, 175: 558913012, 176: 589541445, 177: 621848316,
	178: 655925603, 179: 691870326, 180: 729784819, 181: 769777027, 182: 811960808,
	183: 856456260, 184: 903390063, 185: 952895838, 186: 1005114529, 187: 1060194805,
	188: 1118293480, 189: 1179575962, 190: 1244216724, 191: 1312399800, 192: 1384319309,
	193: 1460180007, 194: 1540197871, 195: 1624600714, 196: 1713628833, 197: 1807535693,
	198: 1906588648, 199: 2011069705, 200: 2121276324
};

export function requiredExpForLevel(table: ExpTable, level: number): number | null {
	return table[level] ?? null;
}

export function computeExpDeltaFromTable(
	table: ExpTable,
	prevLevel: number,
	prevValue: number,
	curLevel: number,
	curValue: number
): number | null {
	// 같은 레벨: 부호 있는 차이
	if (curLevel === prevLevel) {
		return curValue - prevValue;
	}
	// 감소한 경우(대개 OCR 오인식): 증가 합의 대칭 음수로 계산합니다.
	if (curLevel < prevLevel) {
		const up = computeExpDeltaFromTable(table, curLevel, curValue, prevLevel, prevValue);
		return up == null ? null : -up;
	}
	// 레벨 증가(curLevel > prevLevel): 레벨을 걸쳐 합산(항상 0 이상)
	let sum = 0;
	const prevReq = requiredExpForLevel(table, prevLevel);
	if (prevReq == null) return null;
	sum += Math.max(0, prevReq - prevValue);
	for (let lv = prevLevel + 1; lv < curLevel; lv++) {
		const req = requiredExpForLevel(table, lv);
		if (req == null) return null;
		sum += req;
	}
	sum += curValue;
	return sum;
}


